#
# Configuration file for running SMRF
#
# See https://docs.python.org/2/library/configparser.html
#
# The configuration file consists of sections, led by a [section] header and followed
# by name: value entries, with continuations in the style of RFC 822 (see section
# 3.1.1, “LONG HEADER FIELDS”); name=value is also accepted. Note that leading
# whitespace is removed from values. The optional values can contain format strings
# which refer to other values in the same section, or values in a special DEFAULT
# section. Additional defaults can be provided on initialization and retrieval. Lines
# beginning with '#' or ';' are ignored and may be used to provide comments.
#
# Configuration files may include comments, prefixed by specific characters (# and ;).
# Comments may appear on their own in an otherwise empty line, or may be entered in
# lines holding values or section names. In the latter case, they need to be preceded
# by a whitespace character to be recognized as a comment. (For backwards compatibility,
# only ; starts an inline comment, while # does not.)
#
# Section and keys are case insensitive.
#
# Dates: anything pandas.to_datetime() can parse
#
# 20151223 Scott Havens
#

################################################################################
# files for dem and vegitation
################################################################################

[TOPO]
dem:            /data/blizzard/Tuolumne/common_data/topo/tuolx_dem_50m.ipw
mask:           /data/blizzard/Tuolumne/common_data/topo/tuolx_mask_50m.ipw
veg_type:       /data/blizzard/Tuolumne/common_data/topo/tuolx_vegnlcd_50m.ipw
veg_height: 	  /data/blizzard/Tuolumne/common_data/topo/tuolx_vegheight_50m.ipw
veg_k:          /data/blizzard/Tuolumne/common_data/topo/tuolx_vegk_50m.ipw
veg_tau:        /data/blizzard/Tuolumne/common_data/topo/tuolx_vegtau_50m.ipw
type = ipw

# lat/lon for the middle of the basin, used for sunangle
basin_lat:      37.979707
basin_lon:      -119.574931

################################################################################
# dates to run model
################################################################################

[TiMe]
TiMe_SteP: 	60			; time step in minutes to run model, same as iSnobal
# start_date:	2017-04-14 00:00
start_date:	2016-10-01 00:00
end_date:	2017-06-01 00:00 	; model end, YYYY-MM-DD HH:MM
#end_date:	2016-12-02 00:00 	; model end, YYYY-MM-DD HH:MM


# time zone for all times provided and how the model will be run
# see pytz docs for information on what is accepted
time_zone:	UTC

################################################################################
# Stations to use
################################################################################
# stations will always take precedence over client
# stations should be a comma separated list
# stations will filter csv to the desired stations
# client will only work with mysql
# The stations sections is mainly for the mysql data and will return all stations
# specified even if there is no data.


[stations]
stations:	CEVC1,CFL,CNFC1,DAN,DDM,DDMC1,ERY,ERYC1,GNL,GNLC1,HHWC1,HRSC1,KIBC1,KO57,LELC1,LVT,LVTC1,MLHC1,PDSC1,PNCC1,RELC1,SLI,TGCC1,TUM,TUMC1,VGAC1,WWRC1,YYVC1

#client:		TUOL_2017

################################################################################
# CSV data files
################################################################################

#[csv]
#metadata:
#air_temp:
#vapor_pressure:
#precip:
#solar:
#wind_speed:
#wind_direction:
#cloud_factor

################################################################################
# MySQL database
################################################################################

[mysql]
user:              micahsandusky
password:          B3rj3r+572
host:              10.200.28.137
database:          weather_db
metadata:          tbl_metadata	; table for metadata
data_table:		     tbl_level2		; table for the data
station_table:		  tbl_stations	; only required if using [stations]client
air_temp:          air_temp
vapor_pressure:    vapor_pressure
precip:            precip_accum
solar:             solar_radiation
wind_speed:		     wind_speed
wind_direction:	  wind_direction
cloud_factor:		   cloud_factor    ; fraction of sky covered by cloud: actual irradiance/clear-sky irradiance


################################################################################
# air temp distribution
################################################################################
# If the ‘stations’ key is set only those stations will be used, else all
# possible stations will be used

[air_temp]

stations:		CEVC1,CNFC1,DDMC1,ERYC1,GNL,HHWC1,HRSC1,KIBC1,KO57,LELC1,LVTC1,MLHC1,PDSC1,PNCC1,RELC1,SLI,TGCC1,TUM,VGAC1,WWRC1,YYVC1

# parameters for inverse distance weighting
distribution:		idw
detrend:		true	; defaults to false
slope:		-1

################################################################################
# vapor_pressure distribution
################################################################################

[vapor_pressure]

#stations:		CEVC1,CNFC1,ERYC1,HHWC1,KO57,MLHC1,PNCC1,SLI,TGCC1,TUM,WWRC1
stations:       CEVC1,CNFC1,ERYC1,KO57,MLHC1,PNCC1,SLI,TGCC1,WWRC1
distribution:		idw
detrend:		true	; defaults to false
slope:			-1

# for idewptp call
tolerance:		0.01
nthreads:		6

################################################################################
# wind_speed and wind_direction distribution
################################################################################

# IMPORTANT!! Switched from TUM to TUMC1 (CDEC to Mesowest) on 12/16/2016.

[wind]
# stations:		KO57,CFL,DDM,ERY,SLI,TUM,WWRC1
# stations:		KO57,CFL,DDM,ERY,SLI,TUMC1,WWRC1
stations:		KO57,CFL,DDM,ERY,SLI,TUMC1,WWRC1
distribution:   idw
detrend:		false
maxus_netcdf:	/data/blizzard/Tuolumne/andrew_workspace/input/maxus_50m/tuolx_maxus.nc	;maxux netCDF with ‘maxus’ variable

# enhancement for each site, if they are not here it will look in the metadata location
DDM:        6.0
CFL:        3.3
ERY:        4.5
KO57:       3.3
SLI:        8.0
WWRC1:      8.0
station_default:	11.4

# stations that are on the peak, minimum maxus value of all directions will be
# used to ensure that speeds are within reason
peak:


# enhancement for vegetation, one value for each or they will be set to default
veg_default:		11.4
veg_41:			3.3
veg_42:			11.4
veg_43:			11.4

reduction_factor:	0.7	;if wind speeds are still to high, then reduce windward values

################################################################################
# precipitation
################################################################################

[precip]
#stations:		CEVC1,CNFC1,DDMC1,ERYC1,HHWC1,LVTC1,PNCC1,TUM,VGAC1,WWRC1,YYVC1
stations:       CEVC1,CFL,DAN,DDM,ERY,GNLC1,HHWC1,LVT,LVTC1,PDS,PNCC1,SLI,TUM,VGAC1,WWRC1,YYVC1

# DISTRIBUTION METHOD:
# Options -> idw OR dk

# distribution:		idw
# detrend:		true	; defaults to false
# slope:			1

distribution:		dk
slope:              1
# number of threads to use in calculations:
dk_nthreads:		10

#Regression method: 1=least squares; 2=least absolute deviations
#(1 is recommended for precipitation when only a few stations may get meaurements)
regression_method=1


# Millimeters of precipitation to begin a storm
storm_mass_threshold:   1.0

# Storm ending criteria
time_steps_to_end_storms: 6

#Newly Accumulated Snow Density (NASDE) Model
# nasde_model:             susong1999
nasde_model:             marks2017


################################################################################
# albedo
################################################################################

[albedo]
grain_size:		300
max_grain:		2000
dirt:			2.0

# albedo decay parameters
# decay_method options are None, date_method, Hardy2000

decay_method: None
#start_decay:  2017-05-15 00:00
#end_decay:    2017-08-15 00:00
#time_zone:    UTC
#pwr:            0.714

#veg_default:    0.25
#veg_41:         0.36
#veg_42:         0.36
#veg_43:         0.25

#veg_default:    0.35
#veg_41:         0.35
#veg_42:         0.35
#veg_43:         0.25

################################################################################
# solar
################################################################################

[solar]

stations:		CNFC1,DAN,SLI,TGCC1,TUM,WWRC1

# for stoporad, atmospheric parameters
clear_opt_depth:	100
clear_tau:          0.2
clear_omega:		0.85
clear_gamma:		0.3

# cloud factor
distribution:		idw

################################################################################
# thermal
################################################################################

[thermal]
nthreads:		4

method:                 marks1979
nthreads:               4
correct_cloud:          True
correct_veg:            False


################################################################################
# soil temperature
################################################################################

[soil_temp]

temp:			-2.5

################################################################################
# output variables
################################################################################

# create a list of all the available variables that can be output

[output]
# Frequency in time step that should be written to disk:
frequency:		1

# Location to put the files:
out_location:                  ../../awsfTesting/run1/brb/ops/2009/data/smrfOutputs

# Variables to output as individual files:
variables:		thermal, air_temp, vapor_pressure, wind_speed, net_solar, precip, percent_snow, snow_density, dew_point, albedo_vis, albedo_ir, storm_days

# Type of file to output:
file_type:		netcdf

################################################################################
# logging
################################################################################

[logging]
log_level:		debug
# log_file:   /home/micahsandusky/Tuolumne/devel/tuol_albedo_late_season/wy-17/config/smrf.datemethod1.out.2880_7175/log.out

################################################################################
# system variables
################################################################################

[system]

#Threading timeout
time_out: 300

# Location to put the working files:
temp_dir:                      ../../awsfTesting/tmp

# Whether or not to use threading and queues:
threading:		true

# Maximum number of steps to keep:
max_values:		6

################################################################################
# AWSF config details
################################################################################

# use this to control which AWSF module are used
[awsf master]
# Distribute data with smrf
run_smrf: False
# Energy balance with isnobal
run_isnobal: False
# Use gridded WRF data
use_wrf: False

# Run smrf and ipysnobal together (should not be True if other options are True)
run_smrf_ipysnobal: True


[PATHS]
# path to starting drive
path_dr: /data/blizzard/awsftest

#basin and WY
basin: tuolumne2
wy: 2017
# is this operational or development
isops: False

# name of project if development
proj: testproj

# string description of project
desc: This is the project description

# scripts folder
# pathws: ../../smrf/test_data/

# name of smrf and wrf input if running wrf
smrfini: testConfig.ini
wrfini: wrfConfig.ini

############## Forecast variables #############################
[forecast]
forecast_flag: False

# forecast time if running wrf
forecast_date: 2008-10-01 14:00:00

# UTM zone stuff
zone_number: 11
zone_letter: N

################################################################################
# enter grid info for iSnobal
################################################################################

[GRID]
u: 4246192
v:  238672
du: -50
dv: 50
units: m
csys: UTM
nx: 1374
ny: 1339
nbits:  16

################################################################################
# model run files for iSnobal
################################################################################

[FILES]
# ppt_desc_file:  ../../awsfTesting/ppt_desc.txt
prev_mod_file:	../test_data/snow.0023
#prev_mod_file:	../../awsfTesting/snow.1487

wrf_data:

# standard init file conatining roughness image
roughness_init: /data/blizzard/Tuolumne/devel/wy-17/tuol_nasde/data/data.0000_2880/init/init_1_from2016.ipw

[awsf system]
log_level:		debug

# iSnobal threads
ithreads:                      16

###################### variables for restarting iSnobal  ####################
[isnobal restart]

# restart from crash?
restart_crash:    False

# name for new init
new_init:  crash.ipw

# thresh for depths to delete
# set to 0 if normal restart, not crash
depth_thresh:   0.05  #5 cm

# water year hour of last output
wyh_restart_output:   764

############################################################################
########################## iPySnobal Inputs ################################
############################################################################

[ipysnobal]
smrf_ipysnobal_flag: True
nthreads:	20

[ipysnobal initial conditions]
input_type:	ipw
# currently no restart option
# restart: false
init_file: /data/blizzard/Tuolumne/devel/wy-17/tuol_nasde/data/data.0000_2880/init/init_1_blank.ipw
# if input_type is ipw need mask image for masking
mask_file: /data/blizzard/Tuolumne/common_data/topo/tuolx_mask_50m.ipw

# input type will dictate how the following is read
# netcdf -- one file for each forcing variable
# ipw -- either full band images for backward compatibiliy or
#	for different directories (neither implemented)

[ipysnobal output]
frequency:	24

# constants for ipysnobal, these are also the defaults
[ipysnobal constants]
# active layer thickness [m]
max_z_s_0:	0.15
# height of wind speed [m]
z_u:		5
# height of temperature [m]
z_T:		5
# depth of soil temperature [m]
z_g:		0.5
